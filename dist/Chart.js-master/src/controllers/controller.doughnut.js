'use strict';

module.exports = function (Chart) {

	var helpers = Chart.helpers,
	    defaults = Chart.defaults;

	defaults.doughnut = {
		animation: {
			// Boolean - Whether we animate the rotation of the Doughnut
			animateRotate: true,
			// Boolean - Whether we animate scaling the Doughnut from the centre
			animateScale: false
		},
		aspectRatio: 1,
		hover: {
			mode: 'single'
		},
		legendCallback: function legendCallback(chart) {
			var text = [];
			text.push('<ul class="' + chart.id + '-legend">');

			var data = chart.data;
			var datasets = data.datasets;
			var labels = data.labels;

			if (datasets.length) {
				for (var i = 0; i < datasets[0].data.length; ++i) {
					text.push('<li><span style="background-color:' + datasets[0].backgroundColor[i] + '"></span>');
					if (labels[i]) {
						text.push(labels[i]);
					}
					text.push('</li>');
				}
			}

			text.push('</ul>');
			return text.join('');
		},
		legend: {
			labels: {
				generateLabels: function generateLabels(chart) {
					var data = chart.data;
					if (data.labels.length && data.datasets.length) {
						return data.labels.map(function (label, i) {
							var meta = chart.getDatasetMeta(0);
							var ds = data.datasets[0];
							var arc = meta.data[i];
							var custom = arc && arc.custom || {};
							var getValueAtIndexOrDefault = helpers.getValueAtIndexOrDefault;
							var arcOpts = chart.options.elements.arc;
							var fill = custom.backgroundColor ? custom.backgroundColor : getValueAtIndexOrDefault(ds.backgroundColor, i, arcOpts.backgroundColor);
							var stroke = custom.borderColor ? custom.borderColor : getValueAtIndexOrDefault(ds.borderColor, i, arcOpts.borderColor);
							var bw = custom.borderWidth ? custom.borderWidth : getValueAtIndexOrDefault(ds.borderWidth, i, arcOpts.borderWidth);

							return {
								text: label,
								fillStyle: fill,
								strokeStyle: stroke,
								lineWidth: bw,
								hidden: isNaN(ds.data[i]) || meta.data[i].hidden,

								// Extra data used for toggling the correct item
								index: i
							};
						});
					}
					return [];
				}
			},

			onClick: function onClick(e, legendItem) {
				var index = legendItem.index;
				var chart = this.chart;
				var i, ilen, meta;

				for (i = 0, ilen = (chart.data.datasets || []).length; i < ilen; ++i) {
					meta = chart.getDatasetMeta(i);
					// toggle visibility of index if exists
					if (meta.data[index]) {
						meta.data[index].hidden = !meta.data[index].hidden;
					}
				}

				chart.update();
			}
		},

		// The percentage of the chart that we cut out of the middle.
		cutoutPercentage: 50,

		// The rotation of the chart, where the first data arc begins.
		rotation: Math.PI * -0.5,

		// The total circumference of the chart.
		circumference: Math.PI * 2.0,

		// Need to override these to give a nice default
		tooltips: {
			callbacks: {
				title: function title() {
					return '';
				},
				label: function label(tooltipItem, data) {
					var dataLabel = data.labels[tooltipItem.index];
					var value = ': ' + data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];

					if (helpers.isArray(dataLabel)) {
						// show value on first line of multiline label
						// need to clone because we are changing the value
						dataLabel = dataLabel.slice();
						dataLabel[0] += value;
					} else {
						dataLabel += value;
					}

					return dataLabel;
				}
			}
		}
	};

	defaults.pie = helpers.clone(defaults.doughnut);
	helpers.extend(defaults.pie, {
		cutoutPercentage: 0
	});

	Chart.controllers.doughnut = Chart.controllers.pie = Chart.DatasetController.extend({

		dataElementType: Chart.elements.Arc,

		linkScales: helpers.noop,

		// Get index of the dataset in relation to the visible datasets. This allows determining the inner and outer radius correctly
		getRingIndex: function getRingIndex(datasetIndex) {
			var ringIndex = 0;

			for (var j = 0; j < datasetIndex; ++j) {
				if (this.chart.isDatasetVisible(j)) {
					++ringIndex;
				}
			}

			return ringIndex;
		},

		update: function update(reset) {
			var me = this;
			var chart = me.chart,
			    chartArea = chart.chartArea,
			    opts = chart.options,
			    arcOpts = opts.elements.arc,
			    availableWidth = chartArea.right - chartArea.left - arcOpts.borderWidth,
			    availableHeight = chartArea.bottom - chartArea.top - arcOpts.borderWidth,
			    minSize = Math.min(availableWidth, availableHeight),
			    offset = {
				x: 0,
				y: 0
			},
			    meta = me.getMeta(),
			    cutoutPercentage = opts.cutoutPercentage,
			    circumference = opts.circumference;

			// If the chart's circumference isn't a full circle, calculate minSize as a ratio of the width/height of the arc
			if (circumference < Math.PI * 2.0) {
				var startAngle = opts.rotation % (Math.PI * 2.0);
				startAngle += Math.PI * 2.0 * (startAngle >= Math.PI ? -1 : startAngle < -Math.PI ? 1 : 0);
				var endAngle = startAngle + circumference;
				var start = { x: Math.cos(startAngle), y: Math.sin(startAngle) };
				var end = { x: Math.cos(endAngle), y: Math.sin(endAngle) };
				var contains0 = startAngle <= 0 && 0 <= endAngle || startAngle <= Math.PI * 2.0 && Math.PI * 2.0 <= endAngle;
				var contains90 = startAngle <= Math.PI * 0.5 && Math.PI * 0.5 <= endAngle || startAngle <= Math.PI * 2.5 && Math.PI * 2.5 <= endAngle;
				var contains180 = startAngle <= -Math.PI && -Math.PI <= endAngle || startAngle <= Math.PI && Math.PI <= endAngle;
				var contains270 = startAngle <= -Math.PI * 0.5 && -Math.PI * 0.5 <= endAngle || startAngle <= Math.PI * 1.5 && Math.PI * 1.5 <= endAngle;
				var cutout = cutoutPercentage / 100.0;
				var min = { x: contains180 ? -1 : Math.min(start.x * (start.x < 0 ? 1 : cutout), end.x * (end.x < 0 ? 1 : cutout)), y: contains270 ? -1 : Math.min(start.y * (start.y < 0 ? 1 : cutout), end.y * (end.y < 0 ? 1 : cutout)) };
				var max = { x: contains0 ? 1 : Math.max(start.x * (start.x > 0 ? 1 : cutout), end.x * (end.x > 0 ? 1 : cutout)), y: contains90 ? 1 : Math.max(start.y * (start.y > 0 ? 1 : cutout), end.y * (end.y > 0 ? 1 : cutout)) };
				var size = { width: (max.x - min.x) * 0.5, height: (max.y - min.y) * 0.5 };
				minSize = Math.min(availableWidth / size.width, availableHeight / size.height);
				offset = { x: (max.x + min.x) * -0.5, y: (max.y + min.y) * -0.5 };
			}

			chart.borderWidth = me.getMaxBorderWidth(meta.data);
			chart.outerRadius = Math.max((minSize - chart.borderWidth) / 2, 0);
			chart.innerRadius = Math.max(cutoutPercentage ? chart.outerRadius / 100 * cutoutPercentage : 1, 0);
			chart.radiusLength = (chart.outerRadius - chart.innerRadius) / chart.getVisibleDatasetCount();
			chart.offsetX = offset.x * chart.outerRadius;
			chart.offsetY = offset.y * chart.outerRadius;

			meta.total = me.calculateTotal();

			me.outerRadius = chart.outerRadius - chart.radiusLength * me.getRingIndex(me.index);
			me.innerRadius = me.outerRadius - chart.radiusLength;

			helpers.each(meta.data, function (arc, index) {
				me.updateElement(arc, index, reset);
			});
		},

		updateElement: function updateElement(arc, index, reset) {
			var me = this;
			var chart = me.chart,
			    chartArea = chart.chartArea,
			    opts = chart.options,
			    animationOpts = opts.animation,
			    centerX = (chartArea.left + chartArea.right) / 2,
			    centerY = (chartArea.top + chartArea.bottom) / 2,
			    startAngle = opts.rotation,
			    // non reset case handled later
			endAngle = opts.rotation,
			    // non reset case handled later
			dataset = me.getDataset(),
			    circumference = reset && animationOpts.animateRotate ? 0 : arc.hidden ? 0 : me.calculateCircumference(dataset.data[index]) * (opts.circumference / (2.0 * Math.PI)),
			    innerRadius = reset && animationOpts.animateScale ? 0 : me.innerRadius,
			    outerRadius = reset && animationOpts.animateScale ? 0 : me.outerRadius,
			    valueAtIndexOrDefault = helpers.getValueAtIndexOrDefault;

			helpers.extend(arc, {
				// Utility
				_datasetIndex: me.index,
				_index: index,

				// Desired view properties
				_model: {
					x: centerX + chart.offsetX,
					y: centerY + chart.offsetY,
					startAngle: startAngle,
					endAngle: endAngle,
					circumference: circumference,
					outerRadius: outerRadius,
					innerRadius: innerRadius,
					label: valueAtIndexOrDefault(dataset.label, index, chart.data.labels[index])
				}
			});

			var model = arc._model;
			// Resets the visual styles
			this.removeHoverStyle(arc);

			// Set correct angles if not resetting
			if (!reset || !animationOpts.animateRotate) {
				if (index === 0) {
					model.startAngle = opts.rotation;
				} else {
					model.startAngle = me.getMeta().data[index - 1]._model.endAngle;
				}

				model.endAngle = model.startAngle + model.circumference;
			}

			arc.pivot();
		},

		removeHoverStyle: function removeHoverStyle(arc) {
			Chart.DatasetController.prototype.removeHoverStyle.call(this, arc, this.chart.options.elements.arc);
		},

		calculateTotal: function calculateTotal() {
			var dataset = this.getDataset();
			var meta = this.getMeta();
			var total = 0;
			var value;

			helpers.each(meta.data, function (element, index) {
				value = dataset.data[index];
				if (!isNaN(value) && !element.hidden) {
					total += Math.abs(value);
				}
			});

			/* if (total === 0) {
   	total = NaN;
   }*/

			return total;
		},

		calculateCircumference: function calculateCircumference(value) {
			var total = this.getMeta().total;
			if (total > 0 && !isNaN(value)) {
				return Math.PI * 2.0 * (value / total);
			}
			return 0;
		},

		// gets the max border or hover width to properly scale pie charts
		getMaxBorderWidth: function getMaxBorderWidth(elements) {
			var max = 0,
			    index = this.index,
			    length = elements.length,
			    borderWidth,
			    hoverWidth;

			for (var i = 0; i < length; i++) {
				borderWidth = elements[i]._model ? elements[i]._model.borderWidth : 0;
				hoverWidth = elements[i]._chart ? elements[i]._chart.config.data.datasets[index].hoverBorderWidth : 0;

				max = borderWidth > max ? borderWidth : max;
				max = hoverWidth > max ? hoverWidth : max;
			}
			return max;
		}
	});
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnRyb2xsZXIuZG91Z2hudXQuanMiXSwibmFtZXMiOlsibW9kdWxlIiwiZXhwb3J0cyIsIkNoYXJ0IiwiaGVscGVycyIsImRlZmF1bHRzIiwiZG91Z2hudXQiLCJhbmltYXRpb24iLCJhbmltYXRlUm90YXRlIiwiYW5pbWF0ZVNjYWxlIiwiYXNwZWN0UmF0aW8iLCJob3ZlciIsIm1vZGUiLCJsZWdlbmRDYWxsYmFjayIsImNoYXJ0IiwidGV4dCIsInB1c2giLCJpZCIsImRhdGEiLCJkYXRhc2V0cyIsImxhYmVscyIsImxlbmd0aCIsImkiLCJiYWNrZ3JvdW5kQ29sb3IiLCJqb2luIiwibGVnZW5kIiwiZ2VuZXJhdGVMYWJlbHMiLCJtYXAiLCJsYWJlbCIsIm1ldGEiLCJnZXREYXRhc2V0TWV0YSIsImRzIiwiYXJjIiwiY3VzdG9tIiwiZ2V0VmFsdWVBdEluZGV4T3JEZWZhdWx0IiwiYXJjT3B0cyIsIm9wdGlvbnMiLCJlbGVtZW50cyIsImZpbGwiLCJzdHJva2UiLCJib3JkZXJDb2xvciIsImJ3IiwiYm9yZGVyV2lkdGgiLCJmaWxsU3R5bGUiLCJzdHJva2VTdHlsZSIsImxpbmVXaWR0aCIsImhpZGRlbiIsImlzTmFOIiwiaW5kZXgiLCJvbkNsaWNrIiwiZSIsImxlZ2VuZEl0ZW0iLCJpbGVuIiwidXBkYXRlIiwiY3V0b3V0UGVyY2VudGFnZSIsInJvdGF0aW9uIiwiTWF0aCIsIlBJIiwiY2lyY3VtZmVyZW5jZSIsInRvb2x0aXBzIiwiY2FsbGJhY2tzIiwidGl0bGUiLCJ0b29sdGlwSXRlbSIsImRhdGFMYWJlbCIsInZhbHVlIiwiZGF0YXNldEluZGV4IiwiaXNBcnJheSIsInNsaWNlIiwicGllIiwiY2xvbmUiLCJleHRlbmQiLCJjb250cm9sbGVycyIsIkRhdGFzZXRDb250cm9sbGVyIiwiZGF0YUVsZW1lbnRUeXBlIiwiQXJjIiwibGlua1NjYWxlcyIsIm5vb3AiLCJnZXRSaW5nSW5kZXgiLCJyaW5nSW5kZXgiLCJqIiwiaXNEYXRhc2V0VmlzaWJsZSIsInJlc2V0IiwibWUiLCJjaGFydEFyZWEiLCJvcHRzIiwiYXZhaWxhYmxlV2lkdGgiLCJyaWdodCIsImxlZnQiLCJhdmFpbGFibGVIZWlnaHQiLCJib3R0b20iLCJ0b3AiLCJtaW5TaXplIiwibWluIiwib2Zmc2V0IiwieCIsInkiLCJnZXRNZXRhIiwic3RhcnRBbmdsZSIsImVuZEFuZ2xlIiwic3RhcnQiLCJjb3MiLCJzaW4iLCJlbmQiLCJjb250YWluczAiLCJjb250YWluczkwIiwiY29udGFpbnMxODAiLCJjb250YWluczI3MCIsImN1dG91dCIsIm1heCIsInNpemUiLCJ3aWR0aCIsImhlaWdodCIsImdldE1heEJvcmRlcldpZHRoIiwib3V0ZXJSYWRpdXMiLCJpbm5lclJhZGl1cyIsInJhZGl1c0xlbmd0aCIsImdldFZpc2libGVEYXRhc2V0Q291bnQiLCJvZmZzZXRYIiwib2Zmc2V0WSIsInRvdGFsIiwiY2FsY3VsYXRlVG90YWwiLCJlYWNoIiwidXBkYXRlRWxlbWVudCIsImFuaW1hdGlvbk9wdHMiLCJjZW50ZXJYIiwiY2VudGVyWSIsImRhdGFzZXQiLCJnZXREYXRhc2V0IiwiY2FsY3VsYXRlQ2lyY3VtZmVyZW5jZSIsInZhbHVlQXRJbmRleE9yRGVmYXVsdCIsIl9kYXRhc2V0SW5kZXgiLCJfaW5kZXgiLCJfbW9kZWwiLCJtb2RlbCIsInJlbW92ZUhvdmVyU3R5bGUiLCJwaXZvdCIsInByb3RvdHlwZSIsImNhbGwiLCJlbGVtZW50IiwiYWJzIiwiaG92ZXJXaWR0aCIsIl9jaGFydCIsImNvbmZpZyIsImhvdmVyQm9yZGVyV2lkdGgiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBQSxPQUFPQyxPQUFQLEdBQWlCLFVBQVNDLEtBQVQsRUFBZ0I7O0FBRWhDLEtBQUlDLFVBQVVELE1BQU1DLE9BQXBCO0FBQUEsS0FDQ0MsV0FBV0YsTUFBTUUsUUFEbEI7O0FBR0FBLFVBQVNDLFFBQVQsR0FBb0I7QUFDbkJDLGFBQVc7QUFDVjtBQUNBQyxrQkFBZSxJQUZMO0FBR1Y7QUFDQUMsaUJBQWM7QUFK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QUFDQWtHLGlCQUFhdkcsU0FBU2YsQ0FBVCxFQUFZdUgsTUFBWixHQUFxQnhHLFNBQVNmLENBQVQsRUFBWXVILE1BQVosQ0FBbUJDLE1BQW5CLENBQTBCNUgsSUFBMUIsQ0FBK0JDLFFBQS9CLENBQXdDNkIsS0FBeEMsRUFBK0MrRixnQkFBcEUsR0FBdUYsQ0FBcEc7O0FBRUFuQyxVQUFNbEUsY0FBY2tFLEdBQWQsR0FBb0JsRSxXQUFwQixHQUFrQ2tFLEdBQXhDO0FBQ0FBLFVBQU1nQyxhQUFhaEMsR0FBYixHQUFtQmdDLFVBQW5CLEdBQWdDaEMsR0FBdEM7QUFDQTtBQUNELFVBQU9BLEdBQVA7QUFDQTtBQTVLa0YsRUFBL0IsQ0FBckQ7QUE4S0EsQ0E1U0QiLCJmaWxlIjoiY29udHJvbGxlci5kb3VnaG51dC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oQ2hhcnQpIHtcclxuXHJcblx0dmFyIGhlbHBlcnMgPSBDaGFydC5oZWxwZXJzLFxyXG5cdFx0ZGVmYXVsdHMgPSBDaGFydC5kZWZhdWx0cztcclxuXHJcblx0ZGVmYXVsdHMuZG91Z2hudXQgPSB7XHJcblx0XHRhbmltYXRpb246IHtcclxuXHRcdFx0Ly8gQm9vbGVhbiAtIFdoZXRoZXIgd2UgYW5pbWF0ZSB0aGUgcm90YXRpb24gb2YgdGhlIERvdWdobnV0XHJcblx0XHRcdGFuaW1hdGVSb3RhdGU6IHRydWUsXHJcblx0XHRcdC8vIEJvb2xlYW4gLSBXaGV0aGVyIHdlIGFuaW1hdGUgc2NhbGluZyB0aGUgRG91Z2hudXQgZnJvbSB0aGUgY2VudHJlXHJcblx0XHRcdGFuaW1hdGVTY2FsZTogZmFsc2VcclxuXHRcdH0sXHJcblx0XHRhc3BlY3RSYXRpbzogMSxcclxuXHRcdGhvdmVyOiB7XHJcblx0XHRcdG1vZGU6ICdzaW5nbGUnXHJcblx0XHR9LFxyXG5cdFx0bGVnZW5kQ2FsbGJhY2s6IGZ1bmN0aW9uKGNoYXJ0KSB7XHJcblx0XHRcdHZhciB0ZXh0ID0gW107XHJcblx0XHRcdHRleHQucHVzaCgnPHVsIGNsYXNzPVwiJyArIGNoYXJ0LmlkICsgJy1sZWdlbmRcIj4nKTtcclxuXHJcblx0XHRcdHZhciBkYXRhID0gY2hhcnQuZGF0YTtcclxuXHRcdFx0dmFyIGRhdGFzZXRzID0gZGF0YS5kYXRhc2V0cztcclxuXHRcdFx0dmFyIGxhYmVscyA9IGRhdGEubGFiZWxzO1xyXG5cclxuXHRcdFx0aWYgKGRhdGFzZXRzLmxlbmd0aCkge1xyXG5cdFx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YXNldHNbMF0uZGF0YS5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHRcdFx0dGV4dC5wdXNoKCc8bGk+PHNwYW4gc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOicgKyBkYXRhc2V0c1swXS5iYWNrZ3JvdW5kQ29sb3JbaV0gKyAnXCI+PC9zcGFuPicpO1xyXG5cdFx0XHRcdFx0aWYgKGxhYmVsc1tpXSkge1xyXG5cdFx0XHRcdFx0XHR0ZXh0LnB1c2gobGFiZWxzW2ldKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHRleHQucHVzaCgnPC9saT4nKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRleHQucHVzaCgnPC91bD4nKTtcclxuXHRcdFx0cmV0dXJuIHRleHQuam9pbignJyk7XHJcblx0XHR9LFxyXG5cdFx0bGVnZW5kOiB7XHJcblx0XHRcdGxhYmVsczoge1xyXG5cdFx0XHRcdGdlbmVyYXRlTGFiZWxzOiBmdW5jdGlvbihjaGFydCkge1xyXG5cdFx0XHRcdFx0dmFyIGRhdGEgPSBjaGFydC5kYXRhO1xyXG5cdFx0XHRcdFx0aWYgKGRhdGEubGFiZWxzLmxlbmd0aCAmJiBkYXRhLmRhdGFzZXRzLmxlbmd0aCkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gZGF0YS5sYWJlbHMubWFwKGZ1bmN0aW9uKGxhYmVsLCBpKSB7XHJcblx0XHRcdFx0XHRcdFx0dmFyIG1ldGEgPSBjaGFydC5nZXREYXRhc2V0TWV0YSgwKTtcclxuXHRcdFx0XHRcdFx0XHR2YXIgZHMgPSBkYXRhLmRhdGFzZXRzWzBdO1xyXG5cdFx0XHRcdFx0XHRcdHZhciBhcmMgPSBtZXRhLmRhdGFbaV07XHJcblx0XHRcdFx0XHRcdFx0dmFyIGN1c3RvbSA9IGFyYyAmJiBhcmMuY3VzdG9tIHx8IHt9O1xyXG5cdFx0XHRcdFx0XHRcdHZhciBnZXRWYWx1ZUF0SW5kZXhPckRlZmF1bHQgPSBoZWxwZXJzLmdldFZhbHVlQXRJbmRleE9yRGVmYXVsdDtcclxuXHRcdFx0XHRcdFx0XHR2YXIgYXJjT3B0cyA9IGNoYXJ0Lm9wdGlvbnMuZWxlbWVudHMuYXJjO1xyXG5cdFx0XHRcdFx0XHRcdHZhciBmaWxsID0gY3VzdG9tLmJhY2tncm91bmRDb2xvciA/IGN1c3RvbS5iYWNrZ3JvdW5kQ29sb3IgOiBnZXRWYWx1ZUF0SW5kZXhPckRlZmF1bHQoZHMuYmFja2dyb3VuZENvbG9yLCBpLCBhcmNPcHRzLmJhY2tncm91bmRDb2xvcik7XHJcblx0XHRcdFx0XHRcdFx0dmFyIHN0cm9rZSA9IGN1c3RvbS5ib3JkZXJDb2xvciA/IGN1c3RvbS5ib3JkZXJDb2xvciA6IGdldFZhbHVlQXRJbmRleE9yRGVmYXVsdChkcy5ib3JkZXJDb2xvciwgaSwgYXJjT3B0cy5ib3JkZXJDb2xvcik7XHJcblx0XHRcdFx0XHRcdFx0dmFyIGJ3ID0gY3VzdG9tLmJvcmRlcldpZHRoID8gY3VzdG9tLmJvcmRlcldpZHRoIDogZ2V0VmFsdWVBdEluZGV4T3JEZWZhdWx0KGRzLmJvcmRlcldpZHRoLCBpLCBhcmNPcHRzLmJvcmRlcldpZHRoKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHtcclxuXHRcdFx0XHRcdFx0XHRcdHRleHQ6IGxhYmVsLFxyXG5cdFx0XHRcdFx0XHRcdFx0ZmlsbFN0eWxlOiBmaWxsLFxyXG5cdFx0XHRcdFx0XHRcdFx0c3Ryb2tlU3R5bGU6IHN0cm9rZSxcclxuXHRcdFx0XHRcdFx0XHRcdGxpbmVXaWR0aDogYncsXHJcblx0XHRcdFx0XHRcdFx0XHRoaWRkZW46IGlzTmFOKGRzLmRhdGFbaV0pIHx8IG1ldGEuZGF0YVtpXS5oaWRkZW4sXHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gRXh0cmEgZGF0YSB1c2VkIGZvciB0b2dnbGluZyB0aGUgY29ycmVjdCBpdGVtXHJcblx0XHRcdFx0XHRcdFx0XHRpbmRleDogaVxyXG5cdFx0XHRcdFx0XHRcdH07XHJcblx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0cmV0dXJuIFtdO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSxcclxuXHJcblx0XHRcdG9uQ2xpY2s6IGZ1bmN0aW9uKGUsIGxlZ2VuZEl0ZW0pIHtcclxuXHRcdFx0XHR2YXIgaW5kZXggPSBsZWdlbmRJdGVtLmluZGV4O1xyXG5cdFx0XHRcdHZhciBjaGFydCA9IHRoaXMuY2hhcnQ7XHJcblx0XHRcdFx0dmFyIGksIGlsZW4sIG1ldGE7XHJcblxyXG5cdFx0XHRcdGZvciAoaSA9IDAsIGlsZW4gPSAoY2hhcnQuZGF0YS5kYXRhc2V0cyB8fCBbXSkubGVuZ3RoOyBpIDwgaWxlbjsgKytpKSB7XHJcblx0XHRcdFx0XHRtZXRhID0gY2hhcnQuZ2V0RGF0YXNldE1ldGEoaSk7XHJcblx0XHRcdFx0XHQvLyB0b2dnbGUgdmlzaWJpbGl0eSBvZiBpbmRleCBpZiBleGlzdHNcclxuXHRcdFx0XHRcdGlmIChtZXRhLmRhdGFbaW5kZXhdKSB7XHJcblx0XHRcdFx0XHRcdG1ldGEuZGF0YVtpbmRleF0uaGlkZGVuID0gIW1ldGEuZGF0YVtpbmRleF0uaGlkZGVuO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Y2hhcnQudXBkYXRlKCk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblxyXG5cdFx0Ly8gVGhlIHBlcmNlbnRhZ2Ugb2YgdGhlIGNoYXJ0IHRoYXQgd2UgY3V0IG91dCBvZiB0aGUgbWlkZGxlLlxyXG5cdFx0Y3V0b3V0UGVyY2VudGFnZTogNTAsXHJcblxyXG5cdFx0Ly8gVGhlIHJvdGF0aW9uIG9mIHRoZSBjaGFydCwgd2hlcmUgdGhlIGZpcnN0IGRhdGEgYXJjIGJlZ2lucy5cclxuXHRcdHJvdGF0aW9uOiBNYXRoLlBJICogLTAuNSxcclxuXHJcblx0XHQvLyBUaGUgdG90YWwgY2lyY3VtZmVyZW5jZSBvZiB0aGUgY2hhcnQuXHJcblx0XHRjaXJjdW1mZXJlbmNlOiBNYXRoLlBJICogMi4wLFxyXG5cclxuXHRcdC8vIE5lZWQgdG8gb3ZlcnJpZGUgdGhlc2UgdG8gZ2l2ZSBhIG5pY2UgZGVmYXVsdFxyXG5cdFx0dG9vbHRpcHM6IHtcclxuXHRcdFx0Y2FsbGJhY2tzOiB7XHJcblx0XHRcdFx0dGl0bGU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdFx0cmV0dXJuICcnO1xyXG5cdFx0XHRcdH0sXHJcblx0XHRcdFx0bGFiZWw6IGZ1bmN0aW9uKHRvb2x0aXBJdGVtLCBkYXRhKSB7XHJcblx0XHRcdFx0XHR2YXIgZGF0YUxhYmVsID0gZGF0YS5sYWJlbHNbdG9vbHRpcEl0ZW0uaW5kZXhdO1xyXG5cdFx0XHRcdFx0dmFyIHZhbHVlID0gJzogJyArIGRhdGEuZGF0YXNldHNbdG9vbHRpcEl0ZW0uZGF0YXNldEluZGV4XS5kYXRhW3Rvb2x0aXBJdGVtLmluZGV4XTtcclxuXHJcblx0XHRcdFx0XHRpZiAoaGVscGVycy5pc0FycmF5KGRhdGFMYWJlbCkpIHtcclxuXHRcdFx0XHRcdFx0Ly8gc2hvdyB2YWx1ZSBvbiBmaXJzdCBsaW5lIG9mIG11bHRpbGluZSBsYWJlbFxyXG5cdFx0XHRcdFx0XHQvLyBuZWVkIHRvIGNsb25lIGJlY2F1c2Ugd2UgYXJlIGNoYW5naW5nIHRoZSB2YWx1ZVxyXG5cdFx0XHRcdFx0XHRkYXRhTGFiZWwgPSBkYXRhTGFiZWwuc2xpY2UoKTtcclxuXHRcdFx0XHRcdFx0ZGF0YUxhYmVsWzBdICs9IHZhbHVlO1xyXG5cdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0ZGF0YUxhYmVsICs9IHZhbHVlO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdHJldHVybiBkYXRhTGFiZWw7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0ZGVmYXVsdHMucGllID0gaGVscGVycy5jbG9uZShkZWZhdWx0cy5kb3VnaG51dCk7XHJcblx0aGVscGVycy5leHRlbmQoZGVmYXVsdHMucGllLCB7XHJcblx0XHRjdXRvdXRQZXJjZW50YWdlOiAwXHJcblx0fSk7XHJcblxyXG5cclxuXHRDaGFydC5jb250cm9sbGVycy5kb3VnaG51dCA9IENoYXJ0LmNvbnRyb2xsZXJzLnBpZSA9IENoYXJ0LkRhdGFzZXRDb250cm9sbGVyLmV4dGVuZCh7XHJcblxyXG5cdFx0ZGF0YUVsZW1lbnRUeXBlOiBDaGFydC5lbGVtZW50cy5BcmMsXHJcblxyXG5cdFx0bGlua1NjYWxlczogaGVscGVycy5ub29wLFxyXG5cclxuXHRcdC8vIEdldCBpbmRleCBvZiB0aGUgZGF0YXNldCBpbiByZWxhdGlvbiB0byB0aGUgdmlzaWJsZSBkYXRhc2V0cy4gVGhpcyBhbGxvd3MgZGV0ZXJtaW5pbmcgdGhlIGlubmVyIGFuZCBvdXRlciByYWRpdXMgY29ycmVjdGx5XHJcblx0XHRnZXRSaW5nSW5kZXg6IGZ1bmN0aW9uKGRhdGFzZXRJbmRleCkge1xyXG5cdFx0XHR2YXIgcmluZ0luZGV4ID0gMDtcclxuXHJcblx0XHRcdGZvciAodmFyIGogPSAwOyBqIDwgZGF0YXNldEluZGV4OyArK2opIHtcclxuXHRcdFx0XHRpZiAodGhpcy5jaGFydC5pc0RhdGFzZXRWaXNpYmxlKGopKSB7XHJcblx0XHRcdFx0XHQrK3JpbmdJbmRleDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiByaW5nSW5kZXg7XHJcblx0XHR9LFxyXG5cclxuXHRcdHVwZGF0ZTogZnVuY3Rpb24ocmVzZXQpIHtcclxuXHRcdFx0dmFyIG1lID0gdGhpcztcclxuXHRcdFx0dmFyIGNoYXJ0ID0gbWUuY2hhcnQsXHJcblx0XHRcdFx0Y2hhcnRBcmVhID0gY2hhcnQuY2hhcnRBcmVhLFxyXG5cdFx0XHRcdG9wdHMgPSBjaGFydC5vcHRpb25zLFxyXG5cdFx0XHRcdGFyY09wdHMgPSBvcHRzLmVsZW1lbnRzLmFyYyxcclxuXHRcdFx0XHRhdmFpbGFibGVXaWR0aCA9IGNoYXJ0QXJlYS5yaWdodCAtIGNoYXJ0QXJlYS5sZWZ0IC0gYXJjT3B0cy5ib3JkZXJXaWR0aCxcclxuXHRcdFx0XHRhdmFpbGFibGVIZWlnaHQgPSBjaGFydEFyZWEuYm90dG9tIC0gY2hhcnRBcmVhLnRvcCAtIGFyY09wdHMuYm9yZGVyV2lkdGgsXHJcblx0XHRcdFx0bWluU2l6ZSA9IE1hdGgubWluKGF2YWlsYWJsZVdpZHRoLCBhdmFpbGFibGVIZWlnaHQpLFxyXG5cdFx0XHRcdG9mZnNldCA9IHtcclxuXHRcdFx0XHRcdHg6IDAsXHJcblx0XHRcdFx0XHR5OiAwXHJcblx0XHRcdFx0fSxcclxuXHRcdFx0XHRtZXRhID0gbWUuZ2V0TWV0YSgpLFxyXG5cdFx0XHRcdGN1dG91dFBlcmNlbnRhZ2UgPSBvcHRzLmN1dG91dFBlcmNlbnRhZ2UsXHJcblx0XHRcdFx0Y2lyY3VtZmVyZW5jZSA9IG9wdHMuY2lyY3VtZmVyZW5jZTtcclxuXHJcblx0XHRcdC8vIElmIHRoZSBjaGFydCdzIGNpcmN1bWZlcmVuY2UgaXNuJ3QgYSBmdWxsIGNpcmNsZSwgY2FsY3VsYXRlIG1pblNpemUgYXMgYSByYXRpbyBvZiB0aGUgd2lkdGgvaGVpZ2h0IG9mIHRoZSBhcmNcclxuXHRcdFx0aWYgKGNpcmN1bWZlcmVuY2UgPCBNYXRoLlBJICogMi4wKSB7XHJcblx0XHRcdFx0dmFyIHN0YXJ0QW5nbGUgPSBvcHRzLnJvdGF0aW9uICUgKE1hdGguUEkgKiAyLjApO1xyXG5cdFx0XHRcdHN0YXJ0QW5nbGUgKz0gTWF0aC5QSSAqIDIuMCAqIChzdGFydEFuZ2xlID49IE1hdGguUEkgPyAtMSA6IHN0YXJ0QW5nbGUgPCAtTWF0aC5QSSA/IDEgOiAwKTtcclxuXHRcdFx0XHR2YXIgZW5kQW5nbGUgPSBzdGFydEFuZ2xlICsgY2lyY3VtZmVyZW5jZTtcclxuXHRcdFx0XHR2YXIgc3RhcnQgPSB7eDogTWF0aC5jb3Moc3RhcnRBbmdsZSksIHk6IE1hdGguc2luKHN0YXJ0QW5nbGUpfTtcclxuXHRcdFx0XHR2YXIgZW5kID0ge3g6IE1hdGguY29zKGVuZEFuZ2xlKSwgeTogTWF0aC5zaW4oZW5kQW5nbGUpfTtcclxuXHRcdFx0XHR2YXIgY29udGFpbnMwID0gKHN0YXJ0QW5nbGUgPD0gMCAmJiAwIDw9IGVuZEFuZ2xlKSB8fCAoc3RhcnRBbmdsZSA8PSBNYXRoLlBJICogMi4wICYmIE1hdGguUEkgKiAyLjAgPD0gZW5kQW5nbGUpO1xyXG5cdFx0XHRcdHZhciBjb250YWluczkwID0gKHN0YXJ0QW5nbGUgPD0gTWF0aC5QSSAqIDAuNSAmJiBNYXRoLlBJICogMC41IDw9IGVuZEFuZ2xlKSB8fCAoc3RhcnRBbmdsZSA8PSBNYXRoLlBJICogMi41ICYmIE1hdGguUEkgKiAyLjUgPD0gZW5kQW5nbGUpO1xyXG5cdFx0XHRcdHZhciBjb250YWluczE4MCA9IChzdGFydEFuZ2xlIDw9IC1NYXRoLlBJICYmIC1NYXRoLlBJIDw9IGVuZEFuZ2xlKSB8fCAoc3RhcnRBbmdsZSA8PSBNYXRoLlBJICYmIE1hdGguUEkgPD0gZW5kQW5nbGUpO1xyXG5cdFx0XHRcdHZhciBjb250YWluczI3MCA9IChzdGFydEFuZ2xlIDw9IC1NYXRoLlBJICogMC41ICYmIC1NYXRoLlBJICogMC41IDw9IGVuZEFuZ2xlKSB8fCAoc3RhcnRBbmdsZSA8PSBNYXRoLlBJICogMS41ICYmIE1hdGguUEkgKiAxLjUgPD0gZW5kQW5nbGUpO1xyXG5cdFx0XHRcdHZhciBjdXRvdXQgPSBjdXRvdXRQZXJjZW50YWdlIC8gMTAwLjA7XHJcblx0XHRcdFx0dmFyIG1pbiA9IHt4OiBjb250YWluczE4MCA/IC0xIDogTWF0aC5taW4oc3RhcnQueCAqIChzdGFydC54IDwgMCA/IDEgOiBjdXRvdXQpLCBlbmQueCAqIChlbmQueCA8IDAgPyAxIDogY3V0b3V0KSksIHk6IGNvbnRhaW5zMjcwID8gLTEgOiBNYXRoLm1pbihzdGFydC55ICogKHN0YXJ0LnkgPCAwID8gMSA6IGN1dG91dCksIGVuZC55ICogKGVuZC55IDwgMCA/IDEgOiBjdXRvdXQpKX07XHJcblx0XHRcdFx0dmFyIG1heCA9IHt4OiBjb250YWluczAgPyAxIDogTWF0aC5tYXgoc3RhcnQueCAqIChzdGFydC54ID4gMCA/IDEgOiBjdXRvdXQpLCBlbmQueCAqIChlbmQueCA+IDAgPyAxIDogY3V0b3V0KSksIHk6IGNvbnRhaW5zOTAgPyAxIDogTWF0aC5tYXgoc3RhcnQueSAqIChzdGFydC55ID4gMCA/IDEgOiBjdXRvdXQpLCBlbmQueSAqIChlbmQueSA+IDAgPyAxIDogY3V0b3V0KSl9O1xyXG5cdFx0XHRcdHZhciBzaXplID0ge3dpZHRoOiAobWF4LnggLSBtaW4ueCkgKiAwLjUsIGhlaWdodDogKG1heC55IC0gbWluLnkpICogMC41fTtcclxuXHRcdFx0XHRtaW5TaXplID0gTWF0aC5taW4oYXZhaWxhYmxlV2lkdGggLyBzaXplLndpZHRoLCBhdmFpbGFibGVIZWlnaHQgLyBzaXplLmhlaWdodCk7XHJcblx0XHRcdFx0b2Zmc2V0ID0ge3g6IChtYXgueCArIG1pbi54KSAqIC0wLjUsIHk6IChtYXgueSArIG1pbi55KSAqIC0wLjV9O1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRjaGFydC5ib3JkZXJXaWR0aCA9IG1lLmdldE1heEJvcmRlcldpZHRoKG1ldGEuZGF0YSk7XHJcblx0XHRcdGNoYXJ0Lm91dGVyUmFkaXVzID0gTWF0aC5tYXgoKG1pblNpemUgLSBjaGFydC5ib3JkZXJXaWR0aCkgLyAyLCAwKTtcclxuXHRcdFx0Y2hhcnQuaW5uZXJSYWRpdXMgPSBNYXRoLm1heChjdXRvdXRQZXJjZW50YWdlID8gKGNoYXJ0Lm91dGVyUmFkaXVzIC8gMTAwKSAqIChjdXRvdXRQZXJjZW50YWdlKSA6IDEsIDApO1xyXG5cdFx0XHRjaGFydC5yYWRpdXNMZW5ndGggPSAoY2hhcnQub3V0ZXJSYWRpdXMgLSBjaGFydC5pbm5lclJhZGl1cykgLyBjaGFydC5nZXRWaXNpYmxlRGF0YXNldENvdW50KCk7XHJcblx0XHRcdGNoYXJ0Lm9mZnNldFggPSBvZmZzZXQueCAqIGNoYXJ0Lm91dGVyUmFkaXVzO1xyXG5cdFx0XHRjaGFydC5vZmZzZXRZID0gb2Zmc2V0LnkgKiBjaGFydC5vdXRlclJhZGl1cztcclxuXHJcblx0XHRcdG1ldGEudG90YWwgPSBtZS5jYWxjdWxhdGVUb3RhbCgpO1xyXG5cclxuXHRcdFx0bWUub3V0ZXJSYWRpdXMgPSBjaGFydC5vdXRlclJhZGl1cyAtIChjaGFydC5yYWRpdXNMZW5ndGggKiBtZS5nZXRSaW5nSW5kZXgobWUuaW5kZXgpKTtcclxuXHRcdFx0bWUuaW5uZXJSYWRpdXMgPSBtZS5vdXRlclJhZGl1cyAtIGNoYXJ0LnJhZGl1c0xlbmd0aDtcclxuXHJcblx0XHRcdGhlbHBlcnMuZWFjaChtZXRhLmRhdGEsIGZ1bmN0aW9uKGFyYywgaW5kZXgpIHtcclxuXHRcdFx0XHRtZS51cGRhdGVFbGVtZW50KGFyYywgaW5kZXgsIHJlc2V0KTtcclxuXHRcdFx0fSk7XHJcblx0XHR9LFxyXG5cclxuXHRcdHVwZGF0ZUVsZW1lbnQ6IGZ1bmN0aW9uKGFyYywgaW5kZXgsIHJlc2V0KSB7XHJcblx0XHRcdHZhciBtZSA9IHRoaXM7XHJcblx0XHRcdHZhciBjaGFydCA9IG1lLmNoYXJ0LFxyXG5cdFx0XHRcdGNoYXJ0QXJlYSA9IGNoYXJ0LmNoYXJ0QXJlYSxcclxuXHRcdFx0XHRvcHRzID0gY2hhcnQub3B0aW9ucyxcclxuXHRcdFx0XHRhbmltYXRpb25PcHRzID0gb3B0cy5hbmltYXRpb24sXHJcblx0XHRcdFx0Y2VudGVyWCA9IChjaGFydEFyZWEubGVmdCArIGNoYXJ0QXJlYS5yaWdodCkgLyAyLFxyXG5cdFx0XHRcdGNlbnRlclkgPSAoY2hhcnRBcmVhLnRvcCArIGNoYXJ0QXJlYS5ib3R0b20pIC8gMixcclxuXHRcdFx0XHRzdGFydEFuZ2xlID0gb3B0cy5yb3RhdGlvbiwgLy8gbm9uIHJlc2V0IGNhc2UgaGFuZGxlZCBsYXRlclxyXG5cdFx0XHRcdGVuZEFuZ2xlID0gb3B0cy5yb3RhdGlvbiwgLy8gbm9uIHJlc2V0IGNhc2UgaGFuZGxlZCBsYXRlclxyXG5cdFx0XHRcdGRhdGFzZXQgPSBtZS5nZXREYXRhc2V0KCksXHJcblx0XHRcdFx0Y2lyY3VtZmVyZW5jZSA9IHJlc2V0ICYmIGFuaW1hdGlvbk9wdHMuYW5pbWF0ZVJvdGF0ZSA/IDAgOiBhcmMuaGlkZGVuID8gMCA6IG1lLmNhbGN1bGF0ZUNpcmN1bWZlcmVuY2UoZGF0YXNldC5kYXRhW2luZGV4XSkgKiAob3B0cy5jaXJjdW1mZXJlbmNlIC8gKDIuMCAqIE1hdGguUEkpKSxcclxuXHRcdFx0XHRpbm5lclJhZGl1cyA9IHJlc2V0ICYmIGFuaW1hdGlvbk9wdHMuYW5pbWF0ZVNjYWxlID8gMCA6IG1lLmlubmVyUmFkaXVzLFxyXG5cdFx0XHRcdG91dGVyUmFkaXVzID0gcmVzZXQgJiYgYW5pbWF0aW9uT3B0cy5hbmltYXRlU2NhbGUgPyAwIDogbWUub3V0ZXJSYWRpdXMsXHJcblx0XHRcdFx0dmFsdWVBdEluZGV4T3JEZWZhdWx0ID0gaGVscGVycy5nZXRWYWx1ZUF0SW5kZXhPckRlZmF1bHQ7XHJcblxyXG5cdFx0XHRoZWxwZXJzLmV4dGVuZChhcmMsIHtcclxuXHRcdFx0XHQvLyBVdGlsaXR5XHJcblx0XHRcdFx0X2RhdGFzZXRJbmRleDogbWUuaW5kZXgsXHJcblx0XHRcdFx0X2luZGV4OiBpbmRleCxcclxuXHJcblx0XHRcdFx0Ly8gRGVzaXJlZCB2aWV3IHByb3BlcnRpZXNcclxuXHRcdFx0XHRfbW9kZWw6IHtcclxuXHRcdFx0XHRcdHg6IGNlbnRlclggKyBjaGFydC5vZmZzZXRYLFxyXG5cdFx0XHRcdFx0eTogY2VudGVyWSArIGNoYXJ0Lm9mZnNldFksXHJcblx0XHRcdFx0XHRzdGFydEFuZ2xlOiBzdGFydEFuZ2xlLFxyXG5cdFx0XHRcdFx0ZW5kQW5nbGU6IGVuZEFuZ2xlLFxyXG5cdFx0XHRcdFx0Y2lyY3VtZmVyZW5jZTogY2lyY3VtZmVyZW5jZSxcclxuXHRcdFx0XHRcdG91dGVyUmFkaXVzOiBvdXRlclJhZGl1cyxcclxuXHRcdFx0XHRcdGlubmVyUmFkaXVzOiBpbm5lclJhZGl1cyxcclxuXHRcdFx0XHRcdGxhYmVsOiB2YWx1ZUF0SW5kZXhPckRlZmF1bHQoZGF0YXNldC5sYWJlbCwgaW5kZXgsIGNoYXJ0LmRhdGEubGFiZWxzW2luZGV4XSlcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cclxuXHRcdFx0dmFyIG1vZGVsID0gYXJjLl9tb2RlbDtcclxuXHRcdFx0Ly8gUmVzZXRzIHRoZSB2aXN1YWwgc3R5bGVzXHJcblx0XHRcdHRoaXMucmVtb3ZlSG92ZXJTdHlsZShhcmMpO1xyXG5cclxuXHRcdFx0Ly8gU2V0IGNvcnJlY3QgYW5nbGVzIGlmIG5vdCByZXNldHRpbmdcclxuXHRcdFx0aWYgKCFyZXNldCB8fCAhYW5pbWF0aW9uT3B0cy5hbmltYXRlUm90YXRlKSB7XHJcblx0XHRcdFx0aWYgKGluZGV4ID09PSAwKSB7XHJcblx0XHRcdFx0XHRtb2RlbC5zdGFydEFuZ2xlID0gb3B0cy5yb3RhdGlvbjtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0bW9kZWwuc3RhcnRBbmdsZSA9IG1lLmdldE1ldGEoKS5kYXRhW2luZGV4IC0gMV0uX21vZGVsLmVuZEFuZ2xlO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0bW9kZWwuZW5kQW5nbGUgPSBtb2RlbC5zdGFydEFuZ2xlICsgbW9kZWwuY2lyY3VtZmVyZW5jZTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0YXJjLnBpdm90KCk7XHJcblx0XHR9LFxyXG5cclxuXHRcdHJlbW92ZUhvdmVyU3R5bGU6IGZ1bmN0aW9uKGFyYykge1xyXG5cdFx0XHRDaGFydC5EYXRhc2V0Q29udHJvbGxlci5wcm90b3R5cGUucmVtb3ZlSG92ZXJTdHlsZS5jYWxsKHRoaXMsIGFyYywgdGhpcy5jaGFydC5vcHRpb25zLmVsZW1lbnRzLmFyYyk7XHJcblx0XHR9LFxyXG5cclxuXHRcdGNhbGN1bGF0ZVRvdGFsOiBmdW5jdGlvbigpIHtcclxuXHRcdFx0dmFyIGRhdGFzZXQgPSB0aGlzLmdldERhdGFzZXQoKTtcclxuXHRcdFx0dmFyIG1ldGEgPSB0aGlzLmdldE1ldGEoKTtcclxuXHRcdFx0dmFyIHRvdGFsID0gMDtcclxuXHRcdFx0dmFyIHZhbHVlO1xyXG5cclxuXHRcdFx0aGVscGVycy5lYWNoKG1ldGEuZGF0YSwgZnVuY3Rpb24oZWxlbWVudCwgaW5kZXgpIHtcclxuXHRcdFx0XHR2YWx1ZSA9IGRhdGFzZXQuZGF0YVtpbmRleF07XHJcblx0XHRcdFx0aWYgKCFpc05hTih2YWx1ZSkgJiYgIWVsZW1lbnQuaGlkZGVuKSB7XHJcblx0XHRcdFx0XHR0b3RhbCArPSBNYXRoLmFicyh2YWx1ZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHJcblx0XHRcdC8qIGlmICh0b3RhbCA9PT0gMCkge1xyXG5cdFx0XHRcdHRvdGFsID0gTmFOO1xyXG5cdFx0XHR9Ki9cclxuXHJcblx0XHRcdHJldHVybiB0b3RhbDtcclxuXHRcdH0sXHJcblxyXG5cdFx0Y2FsY3VsYXRlQ2lyY3VtZmVyZW5jZTogZnVuY3Rpb24odmFsdWUpIHtcclxuXHRcdFx0dmFyIHRvdGFsID0gdGhpcy5nZXRNZXRhKCkudG90YWw7XHJcblx0XHRcdGlmICh0b3RhbCA+IDAgJiYgIWlzTmFOKHZhbHVlKSkge1xyXG5cdFx0XHRcdHJldHVybiAoTWF0aC5QSSAqIDIuMCkgKiAodmFsdWUgLyB0b3RhbCk7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIDA7XHJcblx0XHR9LFxyXG5cclxuXHRcdC8vIGdldHMgdGhlIG1heCBib3JkZXIgb3IgaG92ZXIgd2lkdGggdG8gcHJvcGVybHkgc2NhbGUgcGllIGNoYXJ0c1xyXG5cdFx0Z2V0TWF4Qm9yZGVyV2lkdGg6IGZ1bmN0aW9uKGVsZW1lbnRzKSB7XHJcblx0XHRcdHZhciBtYXggPSAwLFxyXG5cdFx0XHRcdGluZGV4ID0gdGhpcy5pbmRleCxcclxuXHRcdFx0XHRsZW5ndGggPSBlbGVtZW50cy5sZW5ndGgsXHJcblx0XHRcdFx0Ym9yZGVyV2lkdGgsXHJcblx0XHRcdFx0aG92ZXJXaWR0aDtcclxuXHJcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHRib3JkZXJXaWR0aCA9IGVsZW1lbnRzW2ldLl9tb2RlbCA/IGVsZW1lbnRzW2ldLl9tb2RlbC5ib3JkZXJXaWR0aCA6IDA7XHJcblx0XHRcdFx0aG92ZXJXaWR0aCA9IGVsZW1lbnRzW2ldLl9jaGFydCA/IGVsZW1lbnRzW2ldLl9jaGFydC5jb25maWcuZGF0YS5kYXRhc2V0c1tpbmRleF0uaG92ZXJCb3JkZXJXaWR0aCA6IDA7XHJcblxyXG5cdFx0XHRcdG1heCA9IGJvcmRlcldpZHRoID4gbWF4ID8gYm9yZGVyV2lkdGggOiBtYXg7XHJcblx0XHRcdFx0bWF4ID0gaG92ZXJXaWR0aCA+IG1heCA/IGhvdmVyV2lkdGggOiBtYXg7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIG1heDtcclxuXHRcdH1cclxuXHR9KTtcclxufTtcclxuIl19